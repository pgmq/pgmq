POSTGRES_PASSWORD:=postgres
DATABASE_URL:=postgres://postgres:postgres@0.0.0.0:5432/postgres

format:
	cargo sqlx prepare --database-url ${DATABASE_URL}
	cargo +nightly fmt --all
	cargo clippy

update.readme:
	cargo readme \
		--no-title \
		--no-indent-headings \
		> README.md

run.postgres:
	docker run --rm -d --name pgmq-pg -e POSTGRES_PASSWORD=${POSTGRES_PASSWORD} -p 5432:5432 quay.io/tembo/pgmq-pg:latest

test: run.postgres
	sleep 4;
	echo "Running all tests..."
	sqlx migrate run --database-url ${DATABASE_URL}
	cargo test

test.cleanup:
	docker stop pgmq-pg

setup.env:
	sqlx migrate run
